{% extends "Sparkle2/userarea.html.twig" %}

{% block content %}
{% set userinfo = call_static('\\Froxlor\\CurrentUser', 'getData') %}
<div class="card">
	<div class="card-header">
		<ul class="nav nav-tabs card-header-tabs" id="subnav-tab"
			role="tablist">
			<li class="nav-item"><a class="nav-link active"
				id="subnav-acc-tab" data-toggle="tab" href="#tab-acc" role="tab"
				aria-controls="subnav-acc" aria-selected="true">{{ lng('panel.customers') }}&nbsp;<span
					class="badge badge-pill badge-secondary">{{ accounts.count }}</span></a></li>
			{% if userinfo.customers != 0 %}
			<li class="nav-item"><a class="nav-link" id="subnav-add-tab"
				data-toggle="tab" href="#tab-add" role="tab"
				aria-controls="subnav-add" aria-selected="false"><i
					class="fas fa-user-plus"></i>&nbsp;{{ lng('admin.customer_add') }}</a></li>
			{% endif %}
		</ul>
	</div>
	<div class="card-body tab-content" id="subnav-tabContent">
		<div class="tab-pane fade show active" id="tab-acc" role="tabpanel"
			aria-labelledby="subnav-acc-tab">
			<div class="card">
				<div class="card-body" id="accounts-list">
					{% import "Sparkle2/table-listing.html.twig" as t %}
					{% set content %}
					{% for user in accounts.list %}
					<tr
						class="d-flex{% if user.deactivated > 0 %} text-muted{% endif %}">
						<td class="col-sm-3"><strong>{% if user.deactivated > 0 %}<span
								class="text-danger"><i class="fas fa-ban"></i></span>&nbsp;{% endif %}
								{{ call_static('\\Froxlor\\User', 'getCorrectUserSalutation', [user]) }}</strong></td>
						<td class="col-sm-2"><a
							href="index.php?module=AdminCustomers&view=su&id={{ user.customerid }}">{{ user.loginname }}</a></td>
						<td class="col-sm-1">{{ user.adminname }}</td>
						<td class="col-sm-3">
							<div class="row">
								<div class="col-3">
									<small>Webspace</small>
								</div>
								<div class="col">
									<div class="progress">
										<div class="progress-bar" role="progressbar"
											id="pb-disk-{{ user.customerid }}"
											aria-valuenow="{{ user.diskspace_used }}" aria-valuemin="0"
											aria-valuemax="{{ user.diskspace }}">
											{% if user.diskspace < 0 %}
											&infin;
											{% else %}
											{{ user.diskspace_perc }}
											%
											{% endif %}
										</div>
									</div>
								</div>
							</div>
							<div class="row">
								<div class="col-3">
									<small>Traffic</small>
								</div>
								<div class="col">
									<div class="progress">
										<div class="progress-bar" role="progressbar"
											id="pb-traf-{{ user.customerid }}"
											aria-valuenow="{{ user.traffic_used }}" aria-valuemin="0"
											aria-valuemax="{{ user.traffic }}">
											{% if user.traffic < 0 %}
											&infin;
											{% else %}
											{{ user.traffic_perc }}
											%
											{% endif %}
										</div>
									</div>
								</div>
							</div>
						</td>
						<td class="col-sm-2">{% if user.lastlogin_succ > 0 %} {{ user.lastlogin_succ|date('d.m.Y H:i') }}
							{% else %} {% trans "keine Anmeldung bisher" %} {% endif %}</td>
						<td class="col-sm-1 text-right">{% if user.custom_notes is not empty %}
							<a href="#" data-id="{{ user.customerid }}" data-container="body"
							data-toggle="tooltip" data-placement="left"
							title="{{ user.custom_notes|raw }}" data-html="true"><i
								class="fas fa-comment"></i></a>&nbsp;{% endif %}<a
							href="index.php?module=AdminCustomers&view=edit&id={{ user.customerid }}"
							data-id="{{ user.customerid }}" data-container="body"
							data-toggle="tooltip" data-placement="left"
							title="{{ lng('panel.edit') }}"><i class="fas fa-edit"></i></a> <a
							href="#" class="text-danger delete-btn" data-id="{{ user.id }}"
							data-container="body" data-toggle="tooltip" data-placement="left"
							title="{{ lng('panel.delete') }}"><i class="fas fa-trash-alt"></i></a>
							{% if user.islocked %} <a
							href="index.php?module=AdminCustomers&view=unlock&id={{ user.customerid }}"
							data-id="{{ user.customerid }}" data-container="body"
							data-toggle="tooltip" data-placement="left"
							title="{{ lng('panel.unlock') }}"><i class="fas fa-lock-open"></i></a>
							{% endif %}</td>
					</tr>
					{% endfor %}
					{% endset %}
					{% if accounts.count > 0 %}
					{{ t.listing("accounts-listing", [lng('customer.name'), lng('login.username'), lng('admin.admin'), "", lng('admin.lastlogin_succ'), "|Optionen"], content, [3,2,1,3,2,1]) }}
					<script>
					{% for user in accounts.list %}
						{% if user.diskspace < 0 %}
							$('#pb-disk-{{ user.customerid }}').css('width', '100%');
							$('#pb-disk-{{ user.customerid }}').addClass('bg-secondary');
						{% else %}
							$('#pb-disk-{{ user.customerid }}').css('width', '{{ user.diskspace_perc }}%');
							{% if user.diskspace_perc < 75 %}
								$('#pb-disk-{{ user.customerid }}').addClass('bg-success');
							{% elseif user.diskspace_perc >= 75 and user.diskspace_perc < 90 %}
								$('#pb-disk-{{ user.customerid }}').addClass('bg-warning');
							{% else %}
								$('#pb-disk-{{ user.customerid }}').addClass('bg-danger');
							{% endif %}
						{% endif %}
						{% if user.traffic < 0 %}
    						$('#pb-traf-{{ user.customerid }}').css('width', '100%');
    						$('#pb-traf-{{ user.customerid }}').addClass('bg-secondary');
    					{% else %}
    						$('#pb-traf-{{ user.customerid }}').css('width', '{{ user.traffic_perc }}%');
							{% if user.traffic_perc < 75 %}
    							$('#pb-traf-{{ user.customerid }}').addClass('bg-success');
    						{% elseif user.traffic_perc >= 75 and user.traffic_perc < 90 %}
    							$('#pb-traf-{{ user.customerid }}').addClass('bg-warning');
    						{% else %}
    							$('#pb-traf-{{ user.customerid }}').addClass('bg-danger');
    						{% endif %}
    					{% endif %}
					{% endfor %}
					</script>
					{% else %}
					<div class="alert alert-info" role="alert">
						{% trans "Keine Konten" %}
					</div>
					{% endif %}
				</div>
			</div>
		</div>

		{% if userinfo.customers != 0 %}
		<div class="tab-pane fade" id="tab-add" role="tabpanel"
			aria-labelledby="subnav-add-tab">
			<div class="row">
				<div class="col-sm-12 col-md-6 offset-md-3">
					<h5 class="mb-3">
						<i class="fas fa-user-plus"></i>&nbsp;
						{{ lng('admin.customer_add') }}
					</h5>
					{% import "Sparkle2/misc/form/form.html.twig" as f %}
					{{ f.form(form_data, "index.php?module=AdminCustomers&view=add") }}
				</div>
			</div>
		</div>
		{% endif %}

	</div>
</div>
{% endblock %}
